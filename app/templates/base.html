<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Nails by Anais - Reserva tus citas">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#d63384',
                        'primary-dark': '#a61e4d',
                        'primary-light': '#fce7f3',
                        secondary: '#d4af37',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom tweaks that Tailwind can't easily handle or for specific overrides */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #fff0f3 0%, #fff5f5 100%);
            min-height: 100vh;
        }

        h1,
        h2,
        h3,
        .font-serif {
            font-family: 'Playfair Display', serif;
        }
    </style>
    <title>{% block title %}Nails by Anais{% endblock %}</title>
</head>

<body class="text-gray-800">
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-sm">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center relative">
            <a href="/"
                class="text-2xl font-bold text-primary flex items-center gap-2 font-serif hover:scale-105 transition-transform">
                <span>ðŸ’… Nails by Anais</span>
            </a>

            <!-- Mobile Menu Button -->
            <button id="menu-toggle" class="md:hidden text-primary text-2xl focus:outline-none">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Desktop Nav -->
            <nav id="main-nav" class="hidden md:flex items-center gap-6">
                <ul class="flex items-center gap-1">
                    <li><a href="/" id="nav-home"
                            class="px-4 py-2 rounded-full hover:bg-primary-light hover:text-primary transition-colors font-medium">Inicio</a>
                    </li>
                    <li><a href="/servicios" id="nav-services"
                            class="px-4 py-2 rounded-full hover:bg-primary-light hover:text-primary transition-colors font-medium">Servicios</a>
                    </li>
                    <li id="auth-link"><a href="/login"
                            class="bg-primary text-white px-6 py-2 rounded-full font-bold hover:bg-primary-dark shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5">Login</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="min-h-[calc(100vh-200px)]">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-white py-8 mt-12 border-t border-gray-100">
        <div class="container mx-auto px-4 text-center text-gray-500">
            <p>&copy; 2024 Nails by Anais. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="/static/js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile Menu Logic
            const menuToggle = document.getElementById('menu-toggle');
            const closeMenu = document.getElementById('close-menu');
            const mobileMenu = document.getElementById('mobile-menu');

            function toggleMenu() {
                mobileMenu.classList.toggle('translate-x-full');
                document.body.classList.toggle('overflow-hidden');
            }

            if (menuToggle) menuToggle.addEventListener('click', toggleMenu);
            if (closeMenu) closeMenu.addEventListener('click', toggleMenu);

            // Active Link Highlight
            const path = window.location.pathname;
            if (path === '/' || path === '/index.html') {
                const homeLink = document.getElementById('nav-home');
                if (homeLink) homeLink.classList.add('text-primary', 'bg-primary-light');
            } else if (path.startsWith('/servicios')) {
                const servicesLink = document.getElementById('nav-services');
                if (servicesLink) servicesLink.classList.add('text-primary', 'bg-primary-light');
            }

            // Auth Logic
            async function checkAuth() {
                try {
                    const res = await fetch('/api/auth/me');
                    if (res.ok) {
                        const user = await res.json();

                        // Desktop Update
                        const authLink = document.getElementById('auth-link');
                        const navUl = document.querySelector('nav ul');
                        if (authLink) {
                            // Insert Mis Citas
                            const li = document.createElement('li');
                            li.innerHTML = '<a href="/mis-citas" class="px-4 py-2 rounded-full hover:bg-primary-light hover:text-primary transition-colors font-medium">Mis Citas</a>';
                            navUl.insertBefore(li, authLink);

                            if (user.usr_lvl === 1) {
                                const adminLi = document.createElement('li');
                                adminLi.innerHTML = '<a href="/admin" class="px-4 py-2 rounded-full hover:bg-primary-light hover:text-primary transition-colors font-medium">Admin</a>';
                                navUl.insertBefore(adminLi, authLink);
                            }

                            authLink.innerHTML = '<button id="logout-btn" class="text-gray-600 hover:text-primary font-medium px-4">Logout</button>';
                            document.getElementById('logout-btn').addEventListener('click', async () => {
                                await fetch('/api/auth/logout', { method: 'POST' });
                                window.location.href = '/';
                            });
                        }

                        // Mobile Update
                        const mobileAuth = document.getElementById('mobile-auth-container');
                        if (mobileAuth) {
                            let mobileLinks = `
                                <a href="/mis-citas" class="text-2xl font-bold text-gray-800 py-4 px-6 rounded-2xl hover:bg-pink-50 transition-colors flex items-center gap-4">
                                    <i class="fas fa-calendar-alt text-gray-300 w-8"></i> Mis Citas
                                </a>
                            `;
                            if (user.usr_lvl === 1) {
                                mobileLinks += `
                                    <a href="/admin" class="text-2xl font-bold text-gray-800 py-4 px-6 rounded-2xl hover:bg-pink-50 transition-colors flex items-center gap-4">
                                        <i class="fas fa-user-shield text-gray-300 w-8"></i> Admin Panel
                                    </a>
                                `;
                            }
                            mobileAuth.innerHTML = mobileLinks + `
                                <button id="mobile-logout" class="mt-8 w-full text-center border-2 border-red-50 text-red-400 py-4 rounded-2xl font-bold text-lg hover:bg-red-500 hover:text-white hover:border-red-500 transition-all shadow-sm">
                                    <i class="fas fa-sign-out-alt mr-2"></i> Cerrar SesiÃ³n
                                </button>
                            `;

                            document.getElementById('mobile-logout').addEventListener('click', async () => {
                                await fetch('/api/auth/logout', { method: 'POST' });
                                window.location.href = '/';
                            });
                        }
                    }
                } catch (e) {
                    console.log("Not logged in");
                }
            }
            checkAuth();
        });
    </script>

    <!-- Mobile Nav Dropdown (Moved to bottom of body to avoid stacking context issues) -->
    <div id="mobile-menu"
        class="fixed inset-0 bg-white z-[9999] transform translate-x-full transition-transform duration-300 ease-in-out md:hidden flex flex-col p-0 shadow-2xl">
        <!-- Solid Header for Menu -->
        <div class="flex justify-between items-center p-6 border-b border-gray-100 bg-white">
            <span class="text-xl font-serif font-bold text-primary">Nails by Anais</span>
            <button id="close-menu" class="text-3xl text-gray-400 hover:text-primary p-2">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Scrollable Body with Solid BG -->
        <div class="flex-1 overflow-y-auto px-6 py-8 bg-white">
            <nav class="flex flex-col gap-2">
                <a href="/"
                    class="text-2xl font-bold text-gray-800 py-4 px-6 rounded-2xl hover:bg-pink-50 transition-colors flex items-center gap-4">
                    <i class="fas fa-home text-gray-300 w-8"></i> Inicio
                </a>
                <a href="/servicios"
                    class="text-2xl font-bold text-gray-800 py-4 px-6 rounded-2xl hover:bg-pink-50 transition-colors flex items-center gap-4">
                    <i class="fas fa-magic text-gray-300 w-8"></i> Servicios
                </a>
                <div id="mobile-auth-container" class="flex flex-col gap-2 mt-4">
                    <!-- Injected by Auth JS -->
                    <a href="/login"
                        class="w-full text-center bg-primary text-white py-5 rounded-2xl font-bold text-xl shadow-lg shadow-primary/20">
                        <i class="fas fa-sign-in-alt mr-2"></i> Iniciar SesiÃ³n
                    </a>
                </div>
            </nav>
        </div>

        <!-- Footer with Info -->
        <div class="p-8 text-center text-gray-400 text-sm border-t border-gray-50 bg-gray-50/50">
            <p class="font-bold flex justify-center items-center gap-2 mb-1">
                <span class="w-2 h-2 bg-green-500 rounded-full"></span> Abierto ahora
            </p>
            <p>Elegancia en cada detalle</p>
        </div>
    </div>

    {% block scripts %}{% endblock %}
</body>

</html>