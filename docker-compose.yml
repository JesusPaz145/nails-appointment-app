version: '3.8'

services:
  # Web Service (Python app)
  web:
    build: .
    container_name: nails_web
    restart: always
    environment:
      # These will override or provide defaults if they exist in the environment/UI
      - DB_HOST=${DB_HOST:-192.168.4.175}
      - DB_PORT=${DB_PORT:-5433}
      - DB_USER=${DB_USER}
      - DB_PASS=${DB_PASS}
      - DB_NAME=${DB_NAME}
      - SECRET_KEY=${SECRET_KEY}
      - PYTHONDONTWRITEBYTECODE=1
    ports:
      - "${APP_PORT:-4321}:8000"
    extra_hosts:
      - "host.docker.internal:host-gateway" # Required for Linux to reach host
    networks:
      - nails_net
      #volumes:
      #- ./app:/app/app # Sync code for development (Commented for Prod/Stability)

      # Removed 'db' service as user provides their own

networks:
  nails_net:
    driver: bridge
